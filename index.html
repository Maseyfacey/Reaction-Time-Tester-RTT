<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reaction Time Game</title>
<style>
body {
  background:#222; color:white; text-align:center;
  font-family:Arial; display:flex; flex-direction:column;
  justify-content:center; height:100vh; margin:0;
}
#auth, #game {
  width:300px; margin:0 auto; background:#333;
  border-radius:10px; padding:20px;
}
input { margin:5px; padding:8px; width:90%; border:none; border-radius:5px; }
button { margin-top:10px; padding:8px 15px; border:none; border-radius:6px;
  background:#06c; color:white; cursor:pointer; }
#gameBox {
  background:crimson; border-radius:12px; margin-top:10px;
  height:150px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:18px; transition:background-color .3s;
}
a { color:#0af; }
</style>
</head>
<body>
<h1>‚ö° Reaction Time Game ‚ö°</h1>

<div id="auth">
  <h2>Login / Sign Up</h2>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
  <button id="signupBtn">Sign Up</button>
  <p id="authMsg"></p>
</div>

<div id="game" style="display:none;">
  <h2 id="userLabel"></h2>
  <div id="gameBox">Click to Start</div>
  <p id="result"></p>
  <a href="leaderboard.html">üèÜ View Leaderboard</a><br>
  <button id="logoutBtn">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Elements ---
const authDiv = document.getElementById('auth');
const gameDiv = document.getElementById('game');
const authMsg = document.getElementById('authMsg');
const userLabel = document.getElementById('userLabel');
const gameBox = document.getElementById('gameBox');
const result = document.getElementById('result');

// --- Simple hash helper ---
async function hashPassword(pw) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pw));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

// --- Auth ---
async function signup() {
  const user = username.value.trim();
  const pass = password.value;
  if (!user || !pass) return authMsg.textContent = "Fill in both fields.";
  const snap = await db.collection('users').doc(user).get();
  if (snap.exists) return authMsg.textContent = "Username already taken.";
  const hash = await hashPassword(pass);
  await db.collection('users').doc(user).set({ passwordHash: hash });
  localStorage.setItem('user', user);
  showGame(user);
}

async function login() {
  const user = username.value.trim();
  const pass = password.value;
  if (!user || !pass) return authMsg.textContent = "Fill in both fields.";
  const doc = await db.collection('users').doc(user).get();
  if (!doc.exists) return authMsg.textContent = "No such user.";
  const hash = await hashPassword(pass);
  if (doc.data().passwordHash !== hash) return authMsg.textContent = "Wrong password.";
  localStorage.setItem('user', user);
  showGame(user);
}

function logout() {
  localStorage.removeItem('user');
  gameDiv.style.display = 'none';
  authDiv.style.display = 'block';
}

// --- Show Game ---
function showGame(user) {
  userLabel.textContent = `Welcome, ${user}`;
  authDiv.style.display = 'none';
  gameDiv.style.display = 'block';
}

// --- Game logic ---
let waiting=false,startTime,timeout;
function startGame(){
  gameBox.textContent="Wait for green...";
  gameBox.style.backgroundColor="crimson";
  waiting=true;
  timeout=setTimeout(()=>{
    gameBox.style.backgroundColor="limegreen";
    gameBox.textContent="CLICK!";
    startTime=Date.now();
    waiting=false;
  },Math.random()*3000+1000);
}

gameBox.onclick=async()=>{
  const user=localStorage.getItem('user');
  if(!startTime&&!waiting){startGame();}
  else if(waiting){
    clearTimeout(timeout);
    gameBox.textContent="Too soon! Try again.";
    gameBox.style.backgroundColor="crimson";
    waiting=false;
  }else if(startTime){
    const time=Date.now()-startTime;
    result.textContent=`‚è±Ô∏è ${time} ms!`;
    const ref=db.collection('scores').doc(user);
    const doc=await ref.get();
    if(!doc.exists||time<doc.data().best){
      await ref.set({username:user,best:time});
      result.textContent+=" (New Personal Best!)";
    }
    gameBox.textContent="Click to Start";
    gameBox.style.backgroundColor="crimson";
    startTime=null;
  }
};

// --- Events ---
signupBtn.onclick=signup;
loginBtn.onclick=login;
logoutBtn.onclick=logout;

// Auto-login if remembered
const saved=localStorage.getItem('user');
if(saved) showGame(saved);
</script>
</body>
</html>
